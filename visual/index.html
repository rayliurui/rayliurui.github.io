<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0,maximum-scale=1.0">
    <script src='jquery.min.js' charset="utf-8"></script>
    <script src='echarts/echarts.js' charset="utf-8"></script>
    <script src='index.js' charset="utf-8"></script>
    <script src="people.js"></script>
    <title>青岛疫情</title>
    <style>
        responsive-block {
            display: block;
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            max-width: 100%;
        }
        
        ratio-1-to-1 responsive-block {
            display: block;
            position: relative;
            padding-bottom: 100%;
            height: 0;
            overflow: hidden;
            max-width: 100%;
        }
        
        ratio-4-to-3 responsive-block {
            display: block;
            position: relative;
            padding-bottom: 75%;
            height: 0;
            overflow: hidden;
            max-width: 100%;
        }
        
        responsive-block iframe,
        responsive-block object,
        responsive-block embed {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        body {
            max-width: 350px;
            margin-left: auto;
            margin-right: auto;
            color: #424242;
            margin-top: 0px;
        }
        
        #map {
            width: 100%;
            margin-left: 0;
            margin-right: 0;
        }
        
        h1 {
            text-align: center;
            font-size: 1.5rem;
            font-family: '黑体';
            color: #fff;
            background-color: #42a5f5;
            margin: 0px;
        }
        
        p {
            text-align: center;
            margin: 0;
            font-size: 18px;
        }
        
        b {
            font-weight: 900;
        }
        
        .outline {
            fill: none;
            stroke: #888888;
            stroke-width: 1px;
        }
        
        #tooltip {
            font-size: 10pt;
            font-weight: 900;
            fill: #000000;
            stroke: #ffffff;
            stroke-width: 0.25px;
        }
        
        .node {
            stroke: #ffffff;
        }
        
        .link {
            fill: none;
            stroke: #888888;
            stroke-opacity: 0.5;
        }
        
        .highlight {
            stroke: red;
            stroke-opacity: 1.0;
        }
    </style>
</head>

<body>
    <h1>青岛疫情</h1>
    <br>
    <p>青岛现有确诊病例（例）</p>
    <br>
    <div id="map" style="width: 350px;height:300px;margin-left: 0;margin-right:0;padding:0px"></div>
    <p style="font-size: 12px;text-align:center;">（注：数据截止当天12时。未包括3月10日境外输入病例。）</p>
    <br>
    <p>确诊患者基本情况（例）</p>

    <div id="main" style="width: 350px;height:300px;margin-left: 0;margin-right:0;padding:0px"></div>

    <script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例

        var myChart = echarts.init(document.getElementById('main'));
        var option = {
            tooltip: {
                trigger: 'item',
                triggerOn: 'mousemove'
            },

            animation: true,
            series: [{
                type: 'sankey',
                bottom: '10%',
                layoutIterations: 0,
                focusNodeAdjacency: 'allEdges',
                itemStyle: {
                    borderWidth: 0,
                    color: '#64b5f6'
                },
                data: [{
                    "name": "确诊患者",
                    "value": 62
                }, {
                    "name": "女性",
                    "value": 34
                }, {
                    "name": "男性",
                    "value": 28
                }, {
                    "name": "1~20岁",
                    "value": 4
                }, {
                    "name": "21~40岁",
                    "value": 20
                }, {
                    "name": "41~60岁",
                    "value": 27
                }, {
                    "name": "61~80岁",
                    "value": 9
                }, {
                    "name": "81~100岁",
                    "value": 2
                }],
                links: [{
                    "source": "确诊患者",
                    "target": "男性",
                    "value": 28
                }, {
                    "source": "确诊患者",
                    "target": "女性",
                    "value": 34
                }, {
                    "source": "男性",
                    "target": "1~20岁",
                    "value": 3
                }, {
                    "source": "男性",
                    "target": "21~40岁",
                    "value": 13
                }, {
                    "source": "男性",
                    "target": "41~60岁",
                    "value": 9
                }, {
                    "source": "男性",
                    "target": "61~80岁",
                    "value": 3
                }, {
                    "source": "男性",
                    "target": "81~100岁",
                    "value": 0
                }, {
                    "source": "女性",
                    "target": "1~20岁",
                    "value": 1
                }, {
                    "source": "女性",
                    "target": "21~40岁",
                    "value": 7
                }, {
                    "source": "女性",
                    "target": "41~60岁",
                    "value": 18
                }, {
                    "source": "女性",
                    "target": "61~80岁",
                    "value": 6
                }, {
                    "source": "女性",
                    "target": "81~100岁",
                    "value": 2
                }],
                orient: 'vertical',
                label: {
                    position: 'right'
                },
                lineStyle: {
                    color: 'source',
                    curveness: 0.5,

                }
            }]
        }

        myChart.setOption(option);
    </script>

    <br>
    <p>确诊患者关系</p>

    <br>
    <div id="people" style="width: 350px;height:410px;margin-left: 0;margin-right:0;padding:0px"></div>

    <script>
        var myChart = echarts.init(document.getElementById('people'), 'macarons');
        // 指定图表的配置项和数据
        var option = {
            tooltip: {
                show: false, //默认显示
            },

            legend: { //=========圖表控件
                show: true,

                data: [{
                    name: '青岛本地',
                    icon: 'circle',

                }, {
                    name: '外市至本地',

                    icon: 'circle'
                }, {
                    name: '外省至本地',

                    icon: 'circle'
                }, {
                    name: '外国至本地',

                    icon: 'circle'
                }, {
                    name: '途径多地至本地',

                    icon: 'circle'
                }]
            },
            series: [{
                type: 'graph', //关系图
                name: "监控管理系统",
                layout: 'force',
                legendHoverLink: true,
                hoverAnimation: true,
                coordinateSystem: null,
                xAxisIndex: 0,
                yAxisIndex: 0,
                force: { //力引导图基本配置
                    //initLayout: ,//力引导的初始化布局，默认使用xy轴的标点
                    repulsion: 24, //节点之间的斥力因子。支持数组表达斥力范围，值越大斥力越大。
                    gravity: 0.1, //节点受到的向中心的引力因子。该值越大节点越往中心点靠拢。
                    edgeLength: 80, //边的两个节点之间的距离，这个距离也会受 repulsion。[10, 50] 。值越小则长度越长
                    layoutAnimation: true
                        //因为力引导布局会在多次迭代后才会稳定，这个参数决定是否显示布局的迭代动画，在浏览器端节点数据较多（>100）的时候不建议关闭，布局过程会造成浏览器假死。                        
                },
                scale: true, //是否开启鼠标缩放和平移漫游。默认不开启。如果只想要开启缩放或者平移，可以设置成 'scale' 或者 'move'。设置成 true 为都开启
                nodeScaleRatio: 0.6, //鼠标漫游缩放时节点的相应缩放比例，当设为0时节点不随着鼠标的缩放而缩放
                draggable: true, //节点是否可拖拽，只在使用力引导布局的时候有用。
                focusNodeAdjacency: true, //是否在鼠标移到节点上的时候突出显示节点以及节点的边和邻接节点。

                edgeSymbol: ['none', 'none'], //边两端的标记类型，可以是一个数组分别指定两端，也可以是单个统一指定。默认不显示标记，常见的可以设置为箭头，如下：edgeSymbol: ['circle', 'arrow']
                edgeSymbolSize: 10, //边两端的标记大小，可以是一个数组分别指定两端，也可以是单个统一指定。
                itemStyle: { //===============图形样式，有 normal 和 emphasis 两个状态。normal 是图形在默认状态下的样式；emphasis 是图形在高亮状态下的样式，比如在鼠标悬浮或者图例联动高亮时。
                    normal: { //默认样式
                        label: {
                            show: true
                        },
                        borderWidth: 0, //图形的描边线宽。为 0 时无描边。
                    },
                    emphasis: { //高亮状态

                    }
                },
                lineStyle: { //==========关系边的公用线条样式。
                    normal: {
                        color: '#424242',
                        width: '1',
                        type: 'solid', //线的类型 'solid'（实线）'dashed'（虚线）'dotted'（点线）
                        curveness: 0.3, //线条的曲线程度，从0到1
                        opacity: 1
                            // 图形透明度。支持从 0 到 1 的数字，为 0 时不绘制该图形。默认0.5
                    },
                    emphasis: { //高亮状态
                    }
                },
                label: { //=============图形上的文本标签
                    normal: {
                        show: true, //是否显示标签。
                        position: 'inside', //标签的位置。['50%', '50%'] [x,y]
                        textStyle: { //标签的字体样式
                            color: '#212121', //字体颜色
                            fontWeight: 'bolder', //'normal'标准'bold'粗的'bolder'更粗的'lighter'更细的或100 | 200 | 300 | 400...                          
                            fontSize: 10, //字体大小
                        }
                    },
                    emphasis: { //高亮状态
                    }
                },
                edgeLabel: { //==============线条的边缘标签 
                    normal: {
                        show: false
                    },
                    emphasis: { //高亮状态
                    }
                },
                //别名为nodes   name:影响图形标签显示,value:影响选中后值得显示,category:所在类目的index,symbol:类目节点标记图形,symbolSize:10图形大小
                //label:标签样式。
                data: [{
                    id: 0,
                    category: 4,
                    name: '1',
                    symbolSize: 15
                }, {
                    id: 1,
                    category: 2,
                    name: '2',
                    symbolSize: 15
                }, {
                    id: 2,
                    category: 2,
                    name: '3',
                    symbolSize: 15
                }, {
                    id: 3,
                    category: 2,
                    name: '4',
                    symbolSize: 15
                }, {
                    id: 4,
                    category: 4,
                    name: '5',
                    symbolSize: 15
                }, {
                    id: 5,
                    category: 4,
                    name: '6',
                    symbolSize: 15
                }, {
                    id: 6,
                    category: 2,
                    name: '7',
                    symbolSize: 35
                }, {
                    id: 7,
                    category: 2,
                    name: '8',
                    symbolSize: 15
                }, {
                    id: 8,
                    category: 0,
                    name: '9',
                    symbolSize: 15
                }, {
                    id: 9,
                    category: 2,
                    name: '10',
                    symbolSize: 15
                }, {
                    id: 10,
                    category: 0,
                    name: '11',
                    symbolSize: 20
                }, {
                    id: 11,
                    category: 0,
                    name: '12',
                    symbolSize: 25
                }, {
                    id: 12,
                    category: 0,
                    name: '13',
                    symbolSize: 30
                }, {
                    id: 13,
                    category: 3,
                    name: '14',
                    symbolSize: 25
                }, {
                    id: 14,
                    category: 4,
                    name: '15',
                    symbolSize: 15
                }, {
                    id: 15,
                    category: 2,
                    name: '16',
                    symbolSize: 15
                }, {
                    id: 16,
                    category: 2,
                    name: '17',
                    symbolSize: 25
                }, {
                    id: 17,
                    category: 0,
                    name: '18',
                    symbolSize: 20
                }, {
                    id: 18,
                    category: 2,
                    name: '19',
                    symbolSize: 15
                }, {
                    id: 19,
                    category: 0,
                    name: '20',
                    symbolSize: 25
                }, {
                    id: 20,
                    category: 4,
                    name: '21',
                    symbolSize: 15
                }, {
                    id: 21,
                    category: 2,
                    name: '22',
                    symbolSize: 15
                }, {
                    id: 22,
                    category: 0,
                    name: '23',
                    symbolSize: 20
                }, {
                    id: 23,
                    category: 0,
                    name: '24',
                    symbolSize: 20
                }, {
                    id: 24,
                    category: 2,
                    name: '25',
                    symbolSize: 25
                }, {
                    id: 25,
                    category: 0,
                    name: '26',
                    symbolSize: 20
                }, {
                    id: 26,
                    category: 0,
                    name: '27',
                    symbolSize: 20
                }, {
                    id: 27,
                    category: 0,
                    name: '28',
                    symbolSize: 20
                }, {
                    id: 28,
                    category: 2,
                    name: '29',
                    symbolSize: 25
                }, {
                    id: 29,
                    category: 2,
                    name: '30',
                    symbolSize: 15
                }, {
                    id: 30,
                    category: 0,
                    name: '31',
                    symbolSize: 20
                }, {
                    id: 31,
                    category: 0,
                    name: '32',
                    symbolSize: 45
                }, {
                    id: 32,
                    category: 0,
                    name: '33',
                    symbolSize: 30
                }, {
                    id: 33,
                    category: 0,
                    name: '34',
                    symbolSize: 20
                }, {
                    id: 34,
                    category: 0,
                    name: '35',
                    symbolSize: 30
                }, {
                    id: 35,
                    category: 0,
                    name: '36',
                    symbolSize: 20
                }, {
                    id: 36,
                    category: 0,
                    name: '37',
                    symbolSize: 20
                }, {
                    id: 37,
                    category: 0,
                    name: '38',
                    symbolSize: 20
                }, {
                    id: 38,
                    category: 0,
                    name: '39',
                    symbolSize: 20
                }, {
                    id: 39,
                    category: 0,
                    name: '40',
                    symbolSize: 15
                }, {
                    id: 40,
                    category: 0,
                    name: '41',
                    symbolSize: 15
                }, {
                    id: 41,
                    category: 2,
                    name: '42',
                    symbolSize: 20
                }, {
                    id: 42,
                    category: 0,
                    name: '43',
                    symbolSize: 20
                }, {
                    id: 43,
                    category: 0,
                    name: '44',
                    symbolSize: 20
                }, {
                    id: 44,
                    category: 0,
                    name: '45',
                    symbolSize: 20
                }, {
                    id: 45,
                    category: 0,
                    name: '46',
                    symbolSize: 20
                }, {
                    id: 46,
                    category: 2,
                    name: '47',
                    symbolSize: 20
                }, {
                    id: 47,
                    category: 0,
                    name: '48',
                    symbolSize: 20
                }, {
                    id: 48,
                    category: 0,
                    name: '49',
                    symbolSize: 20
                }, {
                    id: 49,
                    category: 0,
                    name: '50',
                    symbolSize: 15
                }, {
                    id: 50,
                    category: 0,
                    name: '51',
                    symbolSize: 20
                }, {
                    id: 51,
                    category: 0,
                    name: '52',
                    symbolSize: 20
                }, {
                    id: 52,
                    category: 0,
                    name: '53',
                    symbolSize: 20
                }, {
                    id: 53,
                    category: 0,
                    name: '54',
                    symbolSize: 30
                }, {
                    id: 54,
                    category: 1,
                    name: '55',
                    symbolSize: 15
                }, {
                    id: 55,
                    category: 0,
                    name: '56',
                    symbolSize: 20
                }, {
                    id: 56,
                    category: 0,
                    name: '57',
                    symbolSize: 20
                }, {
                    id: 57,
                    category: 0,
                    name: '58',
                    symbolSize: 25
                }, {
                    id: 58,
                    category: 0,
                    name: '59',
                    symbolSize: 20
                }, {
                    id: 59,
                    category: 0,
                    name: '60',
                    symbolSize: 20
                }, {
                    id: 60,
                    category: 4,
                    name: '61',
                    symbolSize: 15
                }, {
                    id: 61,
                    category: 0,
                    name: '62',
                    symbolSize: 15
                }],
                categories: [ //symbol name：用于和 legend 对应以及格式化 tooltip 的内容。 label有效
                    {
                        name: '青岛本地',

                        label: { //标签样式
                        }
                    }, {
                        name: '外市至本地',

                    }, {
                        name: '外省至本地',

                    }, {
                        name: '外国至本地',

                    }, {
                        name: '途径多地至本地',

                    },
                ],
                links: [ //edges是其别名代表节点间的关系数据。
                    {
                        source: 6,
                        target: 10
                    }, {
                        source: 6,
                        target: 11
                    }, {
                        source: 6,
                        target: 12
                    }, {
                        source: 16,
                        target: 17
                    }, {
                        source: 11,
                        target: 19
                    }, {
                        source: 12,
                        target: 19
                    }, {
                        source: 12,
                        target: 22
                    }, {
                        source: 13,
                        target: 23
                    }, {
                        source: 6,
                        target: 25
                    }, {
                        source: 26,
                        target: 31
                    }, {
                        source: 16,
                        target: 27
                    }, {
                        source: 28,
                        target: 30
                    }, {
                        source: 31,
                        target: 32
                    }, {
                        source: 13,
                        target: 33
                    }, {
                        source: 31,
                        target: 34
                    }, {
                        source: 24,
                        target: 35
                    }, {
                        source: 24,
                        target: 36
                    }, {
                        source: 28,
                        target: 37
                    }, {
                        source: 34,
                        target: 38
                    }, {
                        source: 41,
                        target: 42
                    }, {
                        source: 31,
                        target: 43
                    }, {
                        source: 32,
                        target: 44
                    }, {
                        source: 34,
                        target: 45
                    }, {
                        source: 31,
                        target: 47
                    }, {
                        source: 32,
                        target: 50
                    }, {
                        source: 48,
                        target: 51
                    }, {
                        source: 46,
                        target: 52
                    }, {
                        source: 53,
                        target: 55
                    }, {
                        source: 53,
                        target: 56
                    }, {
                        source: 53,
                        target: 57
                    }, {
                        source: 55,
                        target: 57
                    }, {
                        source: 31,
                        target: 58
                    }, {
                        source: 56,
                        target: 59
                    }
                ]
            }]
        };

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);

        /*ECharts3 方法部分 开始*/
        function appendPath(params) { //拼接节点关系并显示在左下角，
            var option = myChart.getOption();
            var series = option.series[params.seriesIndex]; //获取图表
            var nodesOption = series.data; //获取所有数据
            var links = series.links; //获取所有连线
            if (params.dataType == "node") { //dataType可以是edge(线条)或node(数据)
                var id = params.data.id;
                var categoryName = series.categories[params.data.category].name; //获取当前节点的图例名称
                var str = categoryName + ":" + nodesOption[id].name;
                var i = 0;
                var map = {};
                for (i = 0; i < links.length; i++) {
                    map[links[i].source] = links[i].target;
                }

                while (true) {
                    if (map[id] == undefined) {
                        break;
                    }
                    //获取父节点的图例名称并连接
                    str = series.categories[nodesOption[map[id]].category].name + ":" + nodesOption[map[id]].name + "->" + str;
                    id = map[id];
                }
                return str;
            } else if (params.dataType == "edge") { //当鼠标停留在连线上时，暂不处理
                return "";
            }
        }

        function openOrFold(params) { //该事件会提示节点间关系
            var str = appendPath(params);
            document.getElementById("main_1").innerHTML = str;
            return str;
        }

        myChart.on('mouseover', openOrFold);
    </script>
    <p style="font-size: 12px;text-align:center;">（注：圆点数字代表确诊顺序、大小代表接触确诊患者数)</p>
    <br>
    <p style="font-size: 10px;text-align: right;color:#888888">数据收集截止时间：2020年3月14日<br><a href="http://wsjsw.qingdao.gov.cn/n28356065/index.html">数据来源：青岛市卫生健康委员会</a>
    </p>
    <br>
</body>

</html>